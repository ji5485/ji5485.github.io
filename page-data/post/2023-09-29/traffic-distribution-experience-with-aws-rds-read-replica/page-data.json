{
    "componentChunkName": "component---src-page-template-blog-post-item-template-tsx",
    "path": "/post/2023-09-29/traffic-distribution-experience-with-aws-rds-read-replica/",
    "result": {"data":{"markdownRemark":{"html":"<h3 id=\"처음으로-맛본-트래픽-증가-대응-경험\" style=\"position:relative;\"><a href=\"#%EC%B2%98%EC%9D%8C%EC%9C%BC%EB%A1%9C-%EB%A7%9B%EB%B3%B8-%ED%8A%B8%EB%9E%98%ED%94%BD-%EC%A6%9D%EA%B0%80-%EB%8C%80%EC%9D%91-%EA%B2%BD%ED%97%98\" aria-label=\"처음으로 맛본 트래픽 증가 대응 경험 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>처음으로 맛본 트래픽 증가 대응 경험</h3>\n<p>2023년 1월, 처음으로 오픈한 우리 스타트업의 서비스는 7개월 동안 유저 트래픽이 크게 발생하지 않아 그동안 백엔드 서버 1개, 데이터베이스 1개로도 잘 운영되고 있었습니다.</p>\n<p>하지만 7월 말, 천천히 늘어가던 유저 수가 우리 서비스의 좋은 소식과 함께 갑자기 크게 증가하기 시작했는데 서버와 데이터베이스 1개로만 잘 운영하던 서비스가 엄청나게 느려지기 시작했던 것이었습니다.</p>\n<br />\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \n        width: 100%;\n        box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);\n      \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/13111ba2c01a0fdb6551436a6ad61668/02a0d/traffic-distribution-experience-with-aws-rds-read-replica-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3ElEQVQoz61T2W7DMAzz/39o89AVwdYl1mGJBe26KNC9pKsBwoRk0ZSPsiwLCFVFRKC11uejYJ27o5BkZgcTkx/HEC4AHsFnfgSzjubK+46eBROiAfP4nKBawOxjDgG1hP/XIZ29OJzBd8TMEy2Gw/PaxhnSasRY8CfylU/B3z1QNeAtcTo7zBsKg6KJXRJVArtw0bg1sexnQ85ZfbS21cB1C/xsrYsSzHOTUqv0Fy5iIKdbQkR7O+RVDGr8QYCqQdXBpswM7g1jDOfl6/KNdV0hIv1hzuTRcb9s3ADZ37YMEcUF0QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/13111ba2c01a0fdb6551436a6ad61668/a59e9/traffic-distribution-experience-with-aws-rds-read-replica-1.webp 192w,\n/static/13111ba2c01a0fdb6551436a6ad61668/0ca9f/traffic-distribution-experience-with-aws-rds-read-replica-1.webp 384w,\n/static/13111ba2c01a0fdb6551436a6ad61668/dc9b9/traffic-distribution-experience-with-aws-rds-read-replica-1.webp 768w,\n/static/13111ba2c01a0fdb6551436a6ad61668/e2c2f/traffic-distribution-experience-with-aws-rds-read-replica-1.webp 1152w,\n/static/13111ba2c01a0fdb6551436a6ad61668/d1d4a/traffic-distribution-experience-with-aws-rds-read-replica-1.webp 1478w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/13111ba2c01a0fdb6551436a6ad61668/3b721/traffic-distribution-experience-with-aws-rds-read-replica-1.png 192w,\n/static/13111ba2c01a0fdb6551436a6ad61668/66595/traffic-distribution-experience-with-aws-rds-read-replica-1.png 384w,\n/static/13111ba2c01a0fdb6551436a6ad61668/fe486/traffic-distribution-experience-with-aws-rds-read-replica-1.png 768w,\n/static/13111ba2c01a0fdb6551436a6ad61668/d2d74/traffic-distribution-experience-with-aws-rds-read-replica-1.png 1152w,\n/static/13111ba2c01a0fdb6551436a6ad61668/02a0d/traffic-distribution-experience-with-aws-rds-read-replica-1.png 1478w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/13111ba2c01a0fdb6551436a6ad61668/fe486/traffic-distribution-experience-with-aws-rds-read-replica-1.png\"\n            alt=\"./traffic-distribution-experience-with-aws-rds-read-replica-1.png\"\n            title=\"./traffic-distribution-experience-with-aws-rds-read-replica-1.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<br />\n<p>그 당시 토요일 밤 하필 저는 양양에 놀러 간 상황이었는데, 그때에는 다들 무섭게 쌓여가는 유저 문의를 처리하는데 바빠 당장 인프라 문제에 대응할 수 있는 개발 인력이 없었습니다.</p>\n<p>엎친 데 덮친 격으로 끊임없는 유저 문의와 함께 거래 내역이 대략 15,000개가 밀려있는 상황이 발생했었습니다.</p>\n<p>거래 내역이 밀리게 됨에 따라 서비스를 사용하는 유저는 실시간으로 거래 내역 상황을 받아볼 수 없을뿐더러 거래가 밀려 가상 자산을 받지 못하는 상황까지 일어났습니다.</p>\n<p>또한 거래가 발생하게 되면 일일 미션을 달성하게 되어 포인트를 받는 기능이 있는데, 이 또한 계속해서 밀려 제때 포인트를 받지 못해 장애가 발생한 날에만 포인트를 받지 못하는 경우도 생길 수 있었습니다.</p>\n<br />\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \n        width: 100%;\n        box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);\n      \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6c422e8682f0a974e21dcd1d2d5f36a2/ba1e1/traffic-distribution-experience-with-aws-rds-read-replica-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.29166666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABKUlEQVQY022R226cQBBE+f+vsxzFkiOyF2DZ5T4zMLeG4UTg5CGSW6qnqtZRqTKtNX3fsye+vX2HbduYlGIYBkS2/7z0Tykh60pmrT0NOzeY8UbT5KipputvdG0OSc5n5xw7EPQD0/1iGS6sXsPqYPVfgLSTRREkWq7PK4+h4Xfb8lnfeb/n/KhKLuVPzKJOaBDHrc4puwf5s6BsSj4ub1yLN7qhxAVHJiIoPWGsxft4krwPRFlJCZpJEURYRZitwXpPjF+1zTKjrEfZQN2/8DGQxShoM1OPmntdYPSAPjXivCV4h0jkaGLmhXpQVK8KZzXKTMyLRqI/gTFGsmkxXKqCrm0Z+5ZFDczLwjHWMcahI9yaieJR0TYtr2eN/ZsbxxHvPVtK+BD4A8gmzOG/lF90AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/6c422e8682f0a974e21dcd1d2d5f36a2/a59e9/traffic-distribution-experience-with-aws-rds-read-replica-2.webp 192w,\n/static/6c422e8682f0a974e21dcd1d2d5f36a2/0ca9f/traffic-distribution-experience-with-aws-rds-read-replica-2.webp 384w,\n/static/6c422e8682f0a974e21dcd1d2d5f36a2/dc9b9/traffic-distribution-experience-with-aws-rds-read-replica-2.webp 768w,\n/static/6c422e8682f0a974e21dcd1d2d5f36a2/e2c2f/traffic-distribution-experience-with-aws-rds-read-replica-2.webp 1152w,\n/static/6c422e8682f0a974e21dcd1d2d5f36a2/f3efb/traffic-distribution-experience-with-aws-rds-read-replica-2.webp 1536w,\n/static/6c422e8682f0a974e21dcd1d2d5f36a2/c0c3e/traffic-distribution-experience-with-aws-rds-read-replica-2.webp 2084w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/6c422e8682f0a974e21dcd1d2d5f36a2/3b721/traffic-distribution-experience-with-aws-rds-read-replica-2.png 192w,\n/static/6c422e8682f0a974e21dcd1d2d5f36a2/66595/traffic-distribution-experience-with-aws-rds-read-replica-2.png 384w,\n/static/6c422e8682f0a974e21dcd1d2d5f36a2/fe486/traffic-distribution-experience-with-aws-rds-read-replica-2.png 768w,\n/static/6c422e8682f0a974e21dcd1d2d5f36a2/d2d74/traffic-distribution-experience-with-aws-rds-read-replica-2.png 1152w,\n/static/6c422e8682f0a974e21dcd1d2d5f36a2/e8464/traffic-distribution-experience-with-aws-rds-read-replica-2.png 1536w,\n/static/6c422e8682f0a974e21dcd1d2d5f36a2/ba1e1/traffic-distribution-experience-with-aws-rds-read-replica-2.png 2084w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/6c422e8682f0a974e21dcd1d2d5f36a2/fe486/traffic-distribution-experience-with-aws-rds-read-replica-2.png\"\n            alt=\"./traffic-distribution-experience-with-aws-rds-read-replica-2.png\"\n            title=\"./traffic-distribution-experience-with-aws-rds-read-replica-2.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<br />\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \n        width: 100%;\n        box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);\n      \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4960b640a6e044d85def3329ccc1fd34/e058c/traffic-distribution-experience-with-aws-rds-read-replica-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA9klEQVQY0y2QQW4DIQxF57o9Qm/TS3TfO3TbLKpGSSBkYAADQ0Z6ld0ifYHB9n948d7zdToRU2KMYZpzmo7n5FE6ISZSSpRaGftuaq3hQyTez6SPV9z7C/L5xnK/B643h/N3HmskxoRIQ1qj906pwpYLIkIVsTs11V3j0RuSHOH2TY6exTnP6MMKpAmtd3IulFL/mtRKjJE+hp21mdLlUsx4jJ0xD9a4sc8nC/+rTcHlC60LpRRyztycM5LL5WomSh9CsHGkbbM6zdN4HBBSZTmOwx76bKwS6Hs3Z/3OY12NSJsorRrpiJRQadNWCN4bpT//EGXnF3glfr0pMLMCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4960b640a6e044d85def3329ccc1fd34/a59e9/traffic-distribution-experience-with-aws-rds-read-replica-3.webp 192w,\n/static/4960b640a6e044d85def3329ccc1fd34/0ca9f/traffic-distribution-experience-with-aws-rds-read-replica-3.webp 384w,\n/static/4960b640a6e044d85def3329ccc1fd34/dc9b9/traffic-distribution-experience-with-aws-rds-read-replica-3.webp 768w,\n/static/4960b640a6e044d85def3329ccc1fd34/e2c2f/traffic-distribution-experience-with-aws-rds-read-replica-3.webp 1152w,\n/static/4960b640a6e044d85def3329ccc1fd34/f3efb/traffic-distribution-experience-with-aws-rds-read-replica-3.webp 1536w,\n/static/4960b640a6e044d85def3329ccc1fd34/9d55f/traffic-distribution-experience-with-aws-rds-read-replica-3.webp 2166w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4960b640a6e044d85def3329ccc1fd34/3b721/traffic-distribution-experience-with-aws-rds-read-replica-3.png 192w,\n/static/4960b640a6e044d85def3329ccc1fd34/66595/traffic-distribution-experience-with-aws-rds-read-replica-3.png 384w,\n/static/4960b640a6e044d85def3329ccc1fd34/fe486/traffic-distribution-experience-with-aws-rds-read-replica-3.png 768w,\n/static/4960b640a6e044d85def3329ccc1fd34/d2d74/traffic-distribution-experience-with-aws-rds-read-replica-3.png 1152w,\n/static/4960b640a6e044d85def3329ccc1fd34/e8464/traffic-distribution-experience-with-aws-rds-read-replica-3.png 1536w,\n/static/4960b640a6e044d85def3329ccc1fd34/e058c/traffic-distribution-experience-with-aws-rds-read-replica-3.png 2166w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4960b640a6e044d85def3329ccc1fd34/fe486/traffic-distribution-experience-with-aws-rds-read-replica-3.png\"\n            alt=\"./traffic-distribution-experience-with-aws-rds-read-replica-3.png\"\n            title=\"./traffic-distribution-experience-with-aws-rds-read-replica-3.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<br />\n<p>그래서 그 당시 EC2 인스턴스의 CPU와 메모리 사용률이 크게 증가하고, 데이터베이스 CPU 사용률이 거의 100퍼센트에 도달했었습니다.</p>\n<p>그렇게 정말 급하게 엄청난 트래픽의 증가에 대응해야하는 때를 마주하게 되었습니다.</p>\n<h3 id=\"백엔드-서버는-금방-대응하는데-데이터베이스는\" style=\"position:relative;\"><a href=\"#%EB%B0%B1%EC%97%94%EB%93%9C-%EC%84%9C%EB%B2%84%EB%8A%94-%EA%B8%88%EB%B0%A9-%EB%8C%80%EC%9D%91%ED%95%98%EB%8A%94%EB%8D%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4%EB%8A%94\" aria-label=\"백엔드 서버는 금방 대응하는데 데이터베이스는 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>백엔드 서버는 금방 대응하는데 데이터베이스는..?</h3>\n<p>백엔드 서버는 당시 AWS ECS를 통해 관리되고 있었기에 손쉽게 EC2 인스턴스 사양 증가 및 Auto Scaling 설정을 조정하여 서버가 6대까지 실행되도록 설정했습니다.</p>\n<p>그렇게 로드 밸런서를 통해 서버의 트래픽은 안정적으로 분산되도록 했지만 그다음 관문인 데이터베이스가 문제였습니다.</p>\n<p>처음으로 데이터베이스의 CPU 사용률을 저렇게 높게 유지시키는 SQL 문을 찾아봤었는데, 포인트를 지급할 때 중복 지급을 막기 위해 그동안의 내역을 조회하는 쿼리문이 문제였습니다.</p>\n<p>쿼리 최적화 또는 캐시 처리를 해야 했던 상황이지만, 아직 제대로 된 테스트 코드가 존재하지 않았고 이 부분은 유저의 자산과 직결되는 문제라 중요한 부분이었기에 추후 충분한 테스트와 함께 개선해야 한다 생각해서 미뤄두었습니다.</p>\n<p>일단 백엔드 코드 개선 말고 인프라 부분에서 개선할 수 있는 방법을 찾아 보았는데, 예전부터 찾아보고 있었던 Auto Scaling을 통해 자동으로 트래픽 분산을 지원해 주는 AWS RDS Aurora가 떠올랐지만, 그 당시 급한 상황에서 충분한 테스트도 거치지 않고서 섣부르게 도입하는 건 엄청난 도박이었습니다.</p>\n<h3 id=\"rds-읽기-전용-복제본은-어떨까\" style=\"position:relative;\"><a href=\"#rds-%EC%9D%BD%EA%B8%B0-%EC%A0%84%EC%9A%A9-%EB%B3%B5%EC%A0%9C%EB%B3%B8%EC%9D%80-%EC%96%B4%EB%96%A8%EA%B9%8C\" aria-label=\"rds 읽기 전용 복제본은 어떨까 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RDS 읽기 전용 복제본은 어떨까</h3>\n<p>그렇게 결국 인프라 단에서의 남은 방법은 RDS 읽기 전용 복제본을 통한 방법밖에 없었습니다.</p>\n<p>하지만 읽기 전용 복제본을 만들어서 적용하는 방법은 처음이었지만 너무나 다행히도 이미 블로그 포스팅이나 예시가 꽤 많이 나와 있었기 때문에 어려운 점이 없었습니다.</p>\n<p>게다가 지금 사용하고 있는 ORM 라이브러리인 Sequelize에서도 읽기 전용 복제본 설정을 손쉽게 할 수 있어서 빠른 시간 내로 트래픽 증가 대응이 가능했습니다.</p>\n<p>그래서 당시 급한 상황 속에서 정말 자세하게 찾아보지는 못했지만 빠르게 읽기 전용 복제본을 넉넉하게 만들어서 프로덕션 서버로 배포해 데이터베이스 부하를 잘 분산시켰습니다.</p>\n<p>이런 새로운 경험 이후에 RDS 읽기 전용 복제본에 대해 여러 포스팅을 찾아봤었는데 볼수록 너무나도 괜찮은 기능이라고 생각했는데, 이유는 아래와 같습니다.</p>\n<ol>\n<li>\n<p><strong>RDS 인스턴스 당 읽기 전용 복제본은 최대 5개까지 생성할 수 있다.</strong></p>\n<p>필요에 따라 언제든 손쉽게 읽기 전용 복제본의 수를 늘리고 줄일 수 있습니다.</p>\n</li>\n<li>\n<p><strong>읽기 전용 복제본은 일반 RDS 인스턴스로 승격할 수 있다.</strong></p>\n<p>데이터베이스 샤딩, 장애 복구 등의 이유로 독립된 데이터베이스로 분리할 수 있습니다.</p>\n</li>\n<li>\n<p><strong>데이터베이스 엔진에 따라 읽기 전용 복제본에 쓰기 기능이 가능하도록 설정이 가능하다.</strong></p>\n<p>아쉽게도 나는 물리적 복제 방식이 적용된 PostgreSQL을 사용하고 있어서 쓰기 기능을 사용할 수 없지만 논리적 복제 방식이 적용된 MySQL/MariaDB 같은 경우에는 쓰기 기능을 사용할 수 있다고 합니다.</p>\n</li>\n</ol>\n<p>너무나도 손쉽게 만들 수 있어서 그 당시 상황에서 선택할 수 있는 최선의 방법이었지만, 조금 우려되는 부분도 있었습니다.</p>\n<ol>\n<li>\n<p><strong>새로운 읽기 전용 복제본의 적용까지 걸리는 시간이 짧은 편은 아니다.</strong></p>\n<p>이번과 마찬가지로 갑작스럽게 치솟는 트래픽으로 인해 기존에 생성해 놓았던 읽기 전용 복제본으로도 감당이 안 되는 수준이라면 추가로 증설해서 트래픽 증가에 대응해야 합니다.</p>\n<p>하지만 복제본을 생성하는 시간이 짧지 않은 편이고, 새로 추가된 복제본의 엔드포인트를 Sequelize 레플리카 옵션에 추가하고 서버를 새로 배포해야 하는 과정이 필요합니다.</p>\n<p>결국 이 작업이 완료되기 전까지 계속해서 다운 타임이 길어지는 건데 이런 트래픽 스파이크를 장애 없이 대응하기가 조금 어려울 것 같다고 생각했었습니다.</p>\n</li>\n<li>\n<p><strong>마스터 인스턴스에서 처리된 변경 작업이 전파되는 데까지 딜레이가 생길 수 있다.</strong></p>\n<p>Standby 인스턴스에 동기적으로 변경 사항을 반영하는 다중 AZ 배포 방식과는 다르게 읽기 전용 복제본에는 비동기적으로 반영이 이루어집니다.</p>\n<p>그래서 변경 사항이 반영되기까지 딜레이가 생길 수도 있었는데, 가상화폐가 오고 가는 시스템에서 딜레이가 길어져 데이터를 제대로 처리하지 못하는 상황이 발생한다면 서비스 신뢰성에 큰 타격을 입히게 됩니다.</p>\n<p>그래서 이 부분은 읽기 전용 복제본을 적용하기 전부터 우려한 부분이었지만, 더 이상 계속해서 길어지는 다운 타임을 지켜보고만 있을 수는 없었기에 일단 먼저 적용한 후에 모니터링을 진행했었습니다.</p>\n<p>다행히 거의 딜레이가 발생하지 않았었고, 조금 딜레이가 발생하더라도 시간이 엄청 짧았기 때문에 프로덕션 환경을 운영하면서 문제가 발생한 적은 없었습니다.</p>\n</li>\n</ol>\n<h3 id=\"그래서-만드는-방법은\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9E%98%EC%84%9C-%EB%A7%8C%EB%93%9C%EB%8A%94-%EB%B0%A9%EB%B2%95%EC%9D%80\" aria-label=\"그래서 만드는 방법은 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그래서 만드는 방법은?</h3>\n<p>해당 글에서는 Node.js 서버에서 Sequelize를 사용하는 환경을 기준으로 설명하고 있는데, Sequelize를 사용하면 RDS 읽기 전용 복제본을 만들고 적용하는 과정이 되게 간단해집니다.</p>\n<p>먼저, AWS RDS 콘솔 페이지에서 읽기 전용 복제본 생성을 희망하는 인스턴스를 선택하고 작업 메뉴의 읽기 전용 복제본 메뉴를 선택합니다.</p>\n<br />\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \n        width: 100%;\n        box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);\n      \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c6194d13f4de4ea39d2bcd58acb1c0cd/a9406/traffic-distribution-experience-with-aws-rds-read-replica-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.5625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA2klEQVQY022P3UoEMQxG5/3fzicQRBTd6bT5adJ23T2y45Vo4LvI4RDybaUclFKICDKTkYOMYM7BHIM5J2vNX/sYebq9d0SEps6UN/r7E5vnJOdifd2RMFoY6kEVo7QfuaphPdEeeCTNEx8L64F5JzN4zBXYNCbz6866QU2ndEU82ZtyqcKhzkepJ5PH0Rh8+mLvC4txes8vr5QqxFxsj7cjf+paV9QVM0NUzjpqSmvtZOaOuyPWEe90d6ool1KJeSVysIkqv2P8YfYPU0XNOI6Dfd+53270CL4BS1mBNdN1zvYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c6194d13f4de4ea39d2bcd58acb1c0cd/a59e9/traffic-distribution-experience-with-aws-rds-read-replica-4.webp 192w,\n/static/c6194d13f4de4ea39d2bcd58acb1c0cd/0ca9f/traffic-distribution-experience-with-aws-rds-read-replica-4.webp 384w,\n/static/c6194d13f4de4ea39d2bcd58acb1c0cd/dc9b9/traffic-distribution-experience-with-aws-rds-read-replica-4.webp 768w,\n/static/c6194d13f4de4ea39d2bcd58acb1c0cd/e2c2f/traffic-distribution-experience-with-aws-rds-read-replica-4.webp 1152w,\n/static/c6194d13f4de4ea39d2bcd58acb1c0cd/f3efb/traffic-distribution-experience-with-aws-rds-read-replica-4.webp 1536w,\n/static/c6194d13f4de4ea39d2bcd58acb1c0cd/63331/traffic-distribution-experience-with-aws-rds-read-replica-4.webp 2658w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c6194d13f4de4ea39d2bcd58acb1c0cd/3b721/traffic-distribution-experience-with-aws-rds-read-replica-4.png 192w,\n/static/c6194d13f4de4ea39d2bcd58acb1c0cd/66595/traffic-distribution-experience-with-aws-rds-read-replica-4.png 384w,\n/static/c6194d13f4de4ea39d2bcd58acb1c0cd/fe486/traffic-distribution-experience-with-aws-rds-read-replica-4.png 768w,\n/static/c6194d13f4de4ea39d2bcd58acb1c0cd/d2d74/traffic-distribution-experience-with-aws-rds-read-replica-4.png 1152w,\n/static/c6194d13f4de4ea39d2bcd58acb1c0cd/e8464/traffic-distribution-experience-with-aws-rds-read-replica-4.png 1536w,\n/static/c6194d13f4de4ea39d2bcd58acb1c0cd/a9406/traffic-distribution-experience-with-aws-rds-read-replica-4.png 2658w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c6194d13f4de4ea39d2bcd58acb1c0cd/fe486/traffic-distribution-experience-with-aws-rds-read-replica-4.png\"\n            alt=\"./traffic-distribution-experience-with-aws-rds-read-replica-4.png\"\n            title=\"./traffic-distribution-experience-with-aws-rds-read-replica-4.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<br />\n<p>해당 메뉴를 선택하면 읽기 전용 복제본 생성 페이지로 이동하게 됩니다.</p>\n<p>저는 포스팅을 위해 제 환경에서 생성 페이지에 접속했을 때 나타나는 기본 설정을 그대로 캡쳐했지만, 필요에 따라 옵션을 다르게 설정할 수도 있습니다.</p>\n<br />\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \n        width: 100%;\n        box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);\n      \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/337c76870860cc035f206fc68d48d1a8/245f3/traffic-distribution-experience-with-aws-rds-read-replica-5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.1875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABR0lEQVQoz01Si46DMAzj/z/ydGzSBmWl7xcFfHLYpqsUJZA4dZwOP+Md4+2OWSkYa6GNgV4NrHXiW9vQe8e2bWKMa214GQefClLOKKVg33dsvWMIIchHpxHYu8S1Vii1fIv3d57nOA4oG6BDQcwFKaVvbvA+IJfyZtGFEQ+bPtaAp3YCVja+fYDLDdZYaUS2pVa5mPjBOocQ42UhIqUs7GprGHXC7+Jw1x63l8dtcRhfHq/UoI2FD1Fq2axtm0wxPKYZz+eE1pr84DjncYhek7mYrSFD03ySOJSG1UeUtuE8T+zEnOc1svNBlkG6ktx3SfACYywO0a9fOvYuMVkxV0oVza+FdZFtWI2RTVE7NqFnAUGzWrAai5yLaEUAjePNywKS+SzrY4PWqwD2f1tmTNCkFmEfU7qeB7WtTfQlEWPddymUiiP/Aa0abFSIQmHQAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/337c76870860cc035f206fc68d48d1a8/a59e9/traffic-distribution-experience-with-aws-rds-read-replica-5.webp 192w,\n/static/337c76870860cc035f206fc68d48d1a8/0ca9f/traffic-distribution-experience-with-aws-rds-read-replica-5.webp 384w,\n/static/337c76870860cc035f206fc68d48d1a8/dc9b9/traffic-distribution-experience-with-aws-rds-read-replica-5.webp 768w,\n/static/337c76870860cc035f206fc68d48d1a8/e2c2f/traffic-distribution-experience-with-aws-rds-read-replica-5.webp 1152w,\n/static/337c76870860cc035f206fc68d48d1a8/f3efb/traffic-distribution-experience-with-aws-rds-read-replica-5.webp 1536w,\n/static/337c76870860cc035f206fc68d48d1a8/d7afe/traffic-distribution-experience-with-aws-rds-read-replica-5.webp 3148w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/337c76870860cc035f206fc68d48d1a8/3b721/traffic-distribution-experience-with-aws-rds-read-replica-5.png 192w,\n/static/337c76870860cc035f206fc68d48d1a8/66595/traffic-distribution-experience-with-aws-rds-read-replica-5.png 384w,\n/static/337c76870860cc035f206fc68d48d1a8/fe486/traffic-distribution-experience-with-aws-rds-read-replica-5.png 768w,\n/static/337c76870860cc035f206fc68d48d1a8/d2d74/traffic-distribution-experience-with-aws-rds-read-replica-5.png 1152w,\n/static/337c76870860cc035f206fc68d48d1a8/e8464/traffic-distribution-experience-with-aws-rds-read-replica-5.png 1536w,\n/static/337c76870860cc035f206fc68d48d1a8/245f3/traffic-distribution-experience-with-aws-rds-read-replica-5.png 3148w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/337c76870860cc035f206fc68d48d1a8/fe486/traffic-distribution-experience-with-aws-rds-read-replica-5.png\"\n            alt=\"./traffic-distribution-experience-with-aws-rds-read-replica-5.png\"\n            title=\"./traffic-distribution-experience-with-aws-rds-read-replica-5.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<br />\n<p>그런데 여기서 확인할 수 있는 큰 특징이 2가지 더 보입니다.</p>\n<p>첫 번째는 읽기 전용 복제본의 사양을 마스터 노드와 다르게 설정이 가능하다는 점인데, 마스터 노드보다 더 높은 사양으로 복제본을 운영할 수 있습니다.</p>\n<p>그리고 두 번째는 읽기 전용 복제본 또한 일반적인 RDS 인스턴스와 같이 높은 가용성을 위해 다중 AZ 배포 옵션을 사용할 수 있다는 점입니다.</p>\n<p>이렇게 읽기 전용 복제본을 생성하게 되면 아래와 같이 마스터 노드 아래 복제본이 표시됩니다.</p>\n<br />\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \n        width: 100%;\n        box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);\n      \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c7b6eef8021ba4d8e1d2897458f4e215/23ed3/traffic-distribution-experience-with-aws-rds-read-replica-6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAb0lEQVQI142LwQ6CMBAF+/9f59GEyIGITXBbighdcMuYeCDhYPQl8y6TcbooxYz/tn1+NaWJF7qxJc1y8O4+ZsK0krSQ1H4yaEFmpQ6eJgm3x7C3fTZcVKObXgQtX9gOxAX8M3PyFWe5UveyO8mFNz9h6Mklj06OAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c7b6eef8021ba4d8e1d2897458f4e215/a59e9/traffic-distribution-experience-with-aws-rds-read-replica-6.webp 192w,\n/static/c7b6eef8021ba4d8e1d2897458f4e215/0ca9f/traffic-distribution-experience-with-aws-rds-read-replica-6.webp 384w,\n/static/c7b6eef8021ba4d8e1d2897458f4e215/dc9b9/traffic-distribution-experience-with-aws-rds-read-replica-6.webp 768w,\n/static/c7b6eef8021ba4d8e1d2897458f4e215/e2c2f/traffic-distribution-experience-with-aws-rds-read-replica-6.webp 1152w,\n/static/c7b6eef8021ba4d8e1d2897458f4e215/f3efb/traffic-distribution-experience-with-aws-rds-read-replica-6.webp 1536w,\n/static/c7b6eef8021ba4d8e1d2897458f4e215/275c6/traffic-distribution-experience-with-aws-rds-read-replica-6.webp 2958w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c7b6eef8021ba4d8e1d2897458f4e215/3b721/traffic-distribution-experience-with-aws-rds-read-replica-6.png 192w,\n/static/c7b6eef8021ba4d8e1d2897458f4e215/66595/traffic-distribution-experience-with-aws-rds-read-replica-6.png 384w,\n/static/c7b6eef8021ba4d8e1d2897458f4e215/fe486/traffic-distribution-experience-with-aws-rds-read-replica-6.png 768w,\n/static/c7b6eef8021ba4d8e1d2897458f4e215/d2d74/traffic-distribution-experience-with-aws-rds-read-replica-6.png 1152w,\n/static/c7b6eef8021ba4d8e1d2897458f4e215/e8464/traffic-distribution-experience-with-aws-rds-read-replica-6.png 1536w,\n/static/c7b6eef8021ba4d8e1d2897458f4e215/23ed3/traffic-distribution-experience-with-aws-rds-read-replica-6.png 2958w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c7b6eef8021ba4d8e1d2897458f4e215/fe486/traffic-distribution-experience-with-aws-rds-read-replica-6.png\"\n            alt=\"./traffic-distribution-experience-with-aws-rds-read-replica-6.png\"\n            title=\"./traffic-distribution-experience-with-aws-rds-read-replica-6.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<br />\n<p>이제 이렇게 생성한 복제본의 엔드포인트를 Sequelize의 replication 옵션에 추가하고 배포해야 합니다.</p>\n<p>Sequelize는 읽기 및 쓰기 전용 엔드포인트를 구분할 수 있게끔 옵션을 설정할 수 있습니다.</p>\n<p>읽기 전용 복제본을 구성하기 전의 코드는 아래와 같습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> sequelize <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Sequelize</span><span class=\"token punctuation\">(</span>\n  config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'PG_DATABASE'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'PG_USERNAME'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'PG_PASSWORD'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    host<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'PG_HOST'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    dialect<span class=\"token operator\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n    port<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'PG_PORT'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    timezone<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'PG_TIMEZONE'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    models<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">~</span><span class=\"token operator\">~</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>예시 코드에서는 config 모듈을 통해 환경 변수 파일을 불러오고 있습니다.</p>\n<p>각자 환경에서 작업하는 경우에는 적절하게 데이터베이스 인증값을 넣어서 테스트해야 합니다.</p>\n<p>단일 인스턴스에 접속하기 위해서는 위와 같이 코드를 작성해야 했습니다.</p>\n<p>하지만 여러 읽기 전용 복제본을 추가하기 위해서는 아래와 같이 코드를 변경해야 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> sequelize <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Sequelize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  dialect<span class=\"token operator\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n  database<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'PG_DATABASE'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  port<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'PG_PORT'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  timezone<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'PG_TIMEZONE'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  replication<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    read<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span> host<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'PG_HOST_REPLICA_1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">,</span> password <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span> host<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'PG_HOST_REPLICA_2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">,</span> password <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span> host<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'PG_HOST_REPLICA_3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">,</span> password <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    write<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> host<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'PG_HOST'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">,</span> password <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  models<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">~</span><span class=\"token operator\">~</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>위와 같이 replication 옵션을 통해 읽기 전용 복제본을 추가할 수 있고, 쓰기 작업을 위한 마스터 노드 설정까지 손쉽게 할 수 있습니다.</p>\n<p>그런데 위의 코드에서 모든 인스턴스에 대한 패스워드가 동일한 것을 확인할 수 있습니다.</p>\n<p>기본적으로 읽기 전용 복제본 생성 페이지에서는 데이터베이스 암호를 설정하는 부분은 없지만, 생성 후에 변경이 가능합니다.</p>\n<p>이제 이렇게 변경한 코드를 배포하면 RDS 읽기 전용 복제본 추가가 완료됩니다.</p>\n<hr>\n<h3 id=\"출처\" style=\"position:relative;\"><a href=\"#%EC%B6%9C%EC%B2%98\" aria-label=\"출처 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>출처</h3>\n<ol>\n<li>\n<p>AWS RDS 공식 문서 - DB 인스턴스 읽기 전용 복제본 작업</p>\n<p><a href=\"https://docs.aws.amazon.com/ko_kr/AmazonRDS/latest/UserGuide/USER_ReadRepl.html\" target=\"_blank\" rel=\"nofollow\">https://docs.aws.amazon.com/ko_kr/AmazonRDS/latest/UserGuide/USER_ReadRepl.html</a></p>\n</li>\n<li>\n<p>AWS RDS 공식 문서 - Amazon RDS for PostgreSQL의 읽기 전용 복제본 작업</p>\n<p><a href=\"https://docs.aws.amazon.com/ko_kr/AmazonRDS/latest/UserGuide/USER_PostgreSQL.Replication.ReadReplicas.html\" target=\"_blank\" rel=\"nofollow\">https://docs.aws.amazon.com/ko_kr/AmazonRDS/latest/UserGuide/USER_PostgreSQL.Replication.ReadReplicas.html</a></p>\n</li>\n</ol>","frontmatter":{"title":"AWS RDS 읽기 복제본을 통한 데이터베이스 트래픽 분산 경험기","date":"2023-09-29","summary":"데이터베이스 읽기 요청이 많은 경우 활용할 수 있는 RDS 읽기 전용 복제본 사용 경험기를 풀어봤습니다.","categories":["Infrastructure","AWS"],"thumbnail":{"publicURL":"/static/272b0b9fe38b5d632bd46d7bd9139f14/traffic-distribution-experience-with-aws-rds-read-replica.png","childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABCklEQVQoz6VTy27CMBDMr7e/wEdUVQ8IDlUr9cghZ6QcMHUoDo82gCGJwHaCPVUiBYVgR1RdaWV77Rnv7NoeHGaMqdw2b45t87oI20Ab8d2ETZBUEjzd38T/nqEBzkZjuY7x8vQOnqU4SfE/ybLIwRbfGLz5UHle7lxJ7yRsN6Feb+ItRiMfPElwPInOenoustq01hgOPvD40MNz/xVSqs4mWTOsiS5eyqzPACj0uYrbcJ7tNqUUKKX4pBRkQjDjP4iOBwT7NUiywXi3BJlRFFVNr7E3koUQCIIAjDGEYQgynYLN51ilHJM0xle2A8t4dSaKokumTkLbkyjXTaBu1dkq2fUrXD/F1ZRf8NStByl17+AAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/272b0b9fe38b5d632bd46d7bd9139f14/0f157/traffic-distribution-experience-with-aws-rds-read-replica.png","srcSet":"/static/272b0b9fe38b5d632bd46d7bd9139f14/c7aa3/traffic-distribution-experience-with-aws-rds-read-replica.png 192w,\n/static/272b0b9fe38b5d632bd46d7bd9139f14/cff52/traffic-distribution-experience-with-aws-rds-read-replica.png 384w,\n/static/272b0b9fe38b5d632bd46d7bd9139f14/0f157/traffic-distribution-experience-with-aws-rds-read-replica.png 768w","sizes":"(min-width: 768px) 768px, 100vw"},"sources":[{"srcSet":"/static/272b0b9fe38b5d632bd46d7bd9139f14/04b43/traffic-distribution-experience-with-aws-rds-read-replica.webp 192w,\n/static/272b0b9fe38b5d632bd46d7bd9139f14/7efec/traffic-distribution-experience-with-aws-rds-read-replica.webp 384w,\n/static/272b0b9fe38b5d632bd46d7bd9139f14/803f0/traffic-distribution-experience-with-aws-rds-read-replica.webp 768w","type":"image/webp","sizes":"(min-width: 768px) 768px, 100vw"}]},"width":768,"height":449.99999999999994}}}},"tableOfContents":"<ul>\n<li><a href=\"#%EC%B2%98%EC%9D%8C%EC%9C%BC%EB%A1%9C-%EB%A7%9B%EB%B3%B8-%ED%8A%B8%EB%9E%98%ED%94%BD-%EC%A6%9D%EA%B0%80-%EB%8C%80%EC%9D%91-%EA%B2%BD%ED%97%98\">처음으로 맛본 트래픽 증가 대응 경험</a></li>\n<li><a href=\"#%EB%B0%B1%EC%97%94%EB%93%9C-%EC%84%9C%EB%B2%84%EB%8A%94-%EA%B8%88%EB%B0%A9-%EB%8C%80%EC%9D%91%ED%95%98%EB%8A%94%EB%8D%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4%EB%8A%94\">백엔드 서버는 금방 대응하는데 데이터베이스는..?</a></li>\n<li><a href=\"#rds-%EC%9D%BD%EA%B8%B0-%EC%A0%84%EC%9A%A9-%EB%B3%B5%EC%A0%9C%EB%B3%B8%EC%9D%80-%EC%96%B4%EB%96%A8%EA%B9%8C\">RDS 읽기 전용 복제본은 어떨까</a></li>\n<li><a href=\"#%EA%B7%B8%EB%9E%98%EC%84%9C-%EB%A7%8C%EB%93%9C%EB%8A%94-%EB%B0%A9%EB%B2%95%EC%9D%80\">그래서 만드는 방법은?</a></li>\n<li><a href=\"#%EC%B6%9C%EC%B2%98\">출처</a></li>\n</ul>"},"site":{"siteMetadata":{"siteUrl":"https://ji5485.github.io"}}},"pageContext":{"slug":"/post/2023-09-29/traffic-distribution-experience-with-aws-rds-read-replica/","prev":{"slug":"/post/2023-10-15/aws-infrastructure-improvement-experience-1/","title":"AWS 초짜의 실시간으로 운영 중인 서비스 인프라 구조 개선 경험기 1편"},"next":{"slug":"/post/2022-07-08/will-junior-be-able-to-play-the-role-of-a-senior/","title":"과연 주니어가 시니어 역할을 할 수 있을까"}}},
    "staticQueryHashes": []}